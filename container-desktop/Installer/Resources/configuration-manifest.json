{
  "resources": [
    {
      "type": "VersionCheck",
      "id": "CheckWindowsVersion",
      "description": "Check Windows version",
      "runAllwaysFirst": true
    },
    {
      "type": "ShutdownProcess",
      "id": "ShutdownContainerDesktop",
      "description": "Shutting down Container Desktop",
      "fileName": "%APP_PATH%",
      "runAllwaysFirst": true
    },
    {
      "type": "ShutdownProcess",
      "id": "ShutdownProxy",
      "description": "Shutting down Container Desktop proxy",
      "fileName": "%PROXY_PATH%",
      "runAllwaysFirst": true
    },
    {
      "type": "Unpack",
      "id": "UnpackFiles",
      "description": "Unpacking files",
      "resourceUri": "pack://application:,,,/ContainerDesktopInstaller;component/Resources/container-desktop.zip",
      "targetDirectory": "%INSTALLDIR%"
    },
    {
      "type": "CopyPackedFile",
      "id": "CopyDistro",
      "description": "Copy WSL distribution",
      "resourceUri": "pack://application:,,,/ContainerDesktopInstaller;component/Resources/container-desktop-distro.tar.gz",
      "targetDirectory": "%INSTALLDIR%\\Resources"
    },
    {
      "type": "CopyFile",
      "id": "CopyInstaller",
      "description": "Copy installer",
      "source": "%INSTALLER_SOURCE_PATH%",
      "target": "%INSTALLER_TARGET_PATH%"
    },
    {
      "type": "CreateDirectory",
      "id": "CreateAppDataDirectory",
      "description": "Creating Application data directory",
      "directory": "%LOCALAPPDATA%\\%PRODUCT_NAME%"
    },
    {
      "type": "Wsl",
      "id": "EnableWsl",
      "description": "Enable WSL",
      "noUninstall": true
    },
    {
      "type": "InstallMsi",
      "id": "InstallLatestWslKernel",
      "description": "Install latest WSL kernel",
      "uri": "https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi",
      "uninstallDisplayName": "Windows Subsystem for Linux Update",
      "noUninstall": true,
      "dependsOn": ["EnableWsl"]
    },
    {
      "type": "WslDistro",
      "id": "InstallWslDistro",
      "description": "Install Container Desktop WSL distribution",
      "name": "container-desktop",
      "path": "%LOCALAPPDATA%\\%PRODUCT_NAME%\\wsl\\distro",
      "rootfsFileName": "%INSTALLDIR%\\Resources\\container-desktop-distro.tar.gz",
      "dependsOn": [ "InstallLatestWslKernel" ]
    },
    {
      "type": "AddToPath",
      "id": "AddCliToPath",
      "description": "Add Docker CLI tools to the Path",
      "path": "%INSTALLDIR%\\cli"
    },
    {
      "type": "AddShortcut",
      "id": "AddShortcutToStartMenu",
      "description": "Create Start Menu shortcut",
      "location": "StartMenu",
      "targetPath": "%APP_PATH%",
      "linkDescription": "%PRODUCT_DISPLAYNAME%",
      "name": "%PRODUCT_DISPLAYNAME%"
    },
    {
      "type": "RegisterProduct",
      "id": "RegisterProduct",
      "description": "Registering Container Desktop",
      "productName": "ContainerDesktop",
      "displayIcon": "%INSTALLER_TARGET_PATH%",
      "displayName": "Container Desktop",
      "displayVersion": "%PRODUCT_VERSION%",
      "version": "%PRODUCT_VERSION%",
      "installLocation": "%INSTALLDIR%",
      "uninstallString": "%INSTALLER_TARGET_PATH% uninstall"
    }
  ]
}